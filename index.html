<!DOCTYPE html>
<html>
  <head>
    <title>am i çu̻̲̣̟̣̞̮̔̈́ͨ͂̈ͩr͎͖̾ͥ́̏͊͊͑s͇͒ͮ̄ͯ̃̎͊ẻ̯͈̠̖̤̩ͤ̑̐͒d̳̥̰̟̥͔̾̇̌͐͑</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./assets/javascript/application.js"></script>
    <script src="./assets/javascript/web3.min.js"></script>
    <link rel="stylesheet" href="./assets/css/style.css">
  </head>
    <body class="centering">
      <div id="curse-status">Loading...</div>
      <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
      <div id="curse-others">
      </div>
    </body>
    <footer>
    </footer>
</html>

<script>
var Web3 = require("web3");

let contractInstance;

function curse() {
  let address = document.getElementById("curse-victim").value;
  if (!address) {
      return;
  }

  this.contractInstance.curse(address, function(error) {
    if (error) {
      alert(error)
      return;
    }

    alert('You have successfully cursed a helpless fool!');
  });
}

function nullify() {
  this.contractInstance.nullify(function(error) {
    if (error) {
      alert(error)
      return;
    }

    alert('You have successfully nullified the curse!');
  });
}

function amicursed(address) {
  this.contractInstance.amICursed(function(error, cursed) {
    if (error) {
      return;
    }

     if (cursed) {
       document.getElementById('curse-status').innerHTML = ```
       Y̖͍̲̜̫͈̒̐͌ͩ͆̂́̚o̸̖̙͈̫u̩̙͆ͣ̀ ͕̰͑ͨá̵̩̯̭͍̥̥̅̇ͣͥ̏r͍̥̬͈̗̲̫ͥ̕e̼̹̭ͭ̐ͭ͌ͭ̌̆͞ ҉͚͈̟c̡͔̉̀ͬͪ͒u̘̼̒̏́̾̓̓͐ṟ̤̞͇ͣs͇̝̖̪̯ͪ̑ͧ͒͐ͣ̔ê̋͏̞̖d̝͔͖͕ͧ
       <br /><br />
       <button onclick="nullify()">Lift the Curse!</button>
       ```
     } else {
       document.getElementById('curse-status').innerHTML = "You are not cursed";
     }

     document.getElementById('curse-others').innerHTML = ```
     <input id="curse-victim" type="text" placeholder="0x0">
     <button id="cursebutton" type="button" onclick="curse()">Curse</button>
     ```

  });
}

function loadContract() {
  var self = this;
  // Checking if Web3 has been injected by the browser (Mist/MetaMask)
  if (typeof this.web3 !== 'undefined') {
    // Use the browser's ethereum provider
    var provider = web3.currentProvider;
  } else {
    document.getElementById('curse-status').innerHTML = "<a href=\"https://metamask.io/\">Install Metamask to check if you are cursed</a>"
    return;
  }
  this.web3 = new Web3(provider);

  this.web3.version.getNetwork((err, netId) => {
    let contract = self.web3.eth.contract(JSON.parse(contract_abi));

    switch (netId) {
      case "1":
        self.contractInstance = contract.at(mainnet);
        break
      case "3":
        self.contractInstance = contract.at(ropsten);
        break
      case "4":
        self.contractInstance = contract.at(rinkeby);
        break
      case "42":
        self.contractInstance = contract.at(kovan);
        break
      default:
        console.log('This is an unknown network.');
    }

    self.web3.eth.defaultAccount = self.web3.eth.accounts[0];
    amicursed()

    setInterval(function() {
      amicursed()
    }, 5000);

  });
}

window.addEventListener('load', loadContract());
</script>
